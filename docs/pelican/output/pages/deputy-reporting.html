<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>OPG Data</title>
	<meta name="description" content="">
	<meta name="author" content="Ministry of Justice">

	<!-- HTML5 shim, for IE6-8 support of HTML elements -->
	<!--[if lt IE 9]>
		<script src="https://ministryofjustice.github.io/opg-data/theme/html5.js"></script>
	<![endif]-->

	<!-- Styles -->
	<link href="https://ministryofjustice.github.io/opg-data/theme/bootstrap.min.css" rel="stylesheet">
	<link href="https://ministryofjustice.github.io/opg-data/theme/local.css" rel="stylesheet">
	<link href="https://ministryofjustice.github.io/opg-data/theme/pygments.css" rel="stylesheet">

	<!-- Feeds -->
	<link href="https://ministryofjustice.github.io/opg-data/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="OPG Data Atom Feed" />




</head>
<body>
	<div class="topbar">
	  <div class="topbar-inner">
		<div class="container-fluid">
		  <a class="brand" href="https://ministryofjustice.github.io/opg-data/">OPG Data</a>
			<ul class="nav">
						<li><a href="https://ministryofjustice.github.io/opg-data/pages/how-to-publish.html">How To Publish</a></li>
						<li><a href="https://ministryofjustice.github.io/opg-data/pages/list-of-integrations.html">List of Integrations</a></li>
						<li><a href="https://ministryofjustice.github.io/opg-data/pages/technologies-used.html">Technologies used</a></li>
						<li><a href="https://ministryofjustice.github.io/opg-data/pages/the-team.html">The Team</a></li>
					<li ><a href="https://ministryofjustice.github.io/opg-data/category/misc.html">misc</a></li>
			</ul>
			<p class="pull-right"><a href="https://ministryofjustice.github.io/opg-data/archives.html">[archives]</a> <a href="https://ministryofjustice.github.io/opg-data/tags.html">[tags]</a></p>
		</div>
	  </div>
	</div>

	<div class="container-fluid">
	  <div class="sidebar">
		<div class="well">
			<h3>Blogroll</h3>
			<ul>
				<li><a href="https://github.com/ministryofjustice/opg-data">OPG Data</a></li>
				<li><a href="https://github.com/ministryofjustice/opg-data-deputy-reporting">OPG Data Deputy Reporting</a></li>
				<li><a href="https://github.com/ministryofjustice/opg-data-lpa-codes">OPG Data LPA Codes</a></li>
				<li><a href="http://getpelican.com/">Pelican</a></li>
				<li><a href="http://python.org/">Python.org</a></li>
				<li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
			</ul>
			<div class="social">
			<h3>Social</h3>
			<ul>
				<li><a href="https://www.publicguardian-scotland.gov.uk/general/contact-us">OPG Contact Us</a></li>
			</ul>
			</div>
		</div>
	  </div>
	  <div class="content">
	<div class='page'>
		<div class="page-header"><h1>Deputy Reporting</h1></div>
		<div><h4>Purpose</h4>
<p>Data Deputy Reporting is comprised of a number of endpoints used by the Digideps frontend 
application to send Deputy Reports and their supporting documents to the Sirius case management 
system so that cases may be administered by OPG staff.</p>
<p>This is accomplished by a process in which documents are set to 'QUEUED' on 
submission of a report and supporting documents. An ECS task then polls for the queued 
documents every 5 minutes (or whatever the period is set to in the respective environment). </p>
<p>It then sends them one by one to our endpoints as a standard http request with content type 
<code>application/json</code> and a <code>base64</code> encoded payload. After validation, this is forwarded to 
the the Sirius API and the documents are stored in S3 on the Sirius side and become visible 
to the Sirius case workers.</p>
<h4>Consumers of this API</h4>
<ul>
<li>Sirius - <a href="https://github.com/ministryofjustice/opg-sirius">opg-sirius</a></li>
<li>DigiDeps - <a href="https://github.com/ministryofjustice/digideps">opg-use-an-lpa</a></li>
</ul>
<h4>Integration Repositories</h4>
<ul>
<li>Deputy Reporting - <a href="https://github.com/ministryofjustice/opg-data-deputy-reporting">opg-data-lpa-codes</a></li>
</ul>
<h4>Integration Location</h4>
<ul>
<li>Sirius Account (development, preproduction, production)</li>
<li>EU West 1</li>
</ul>
<h4>Security</h4>
<p>URLs to the endpoint's DNS is publicly accessible but locked down by AWS Authentication to only 
be accessible from the ECS task's role of the scheduled polling service from the respective 
Digideps account for the environment. </p>
<h4>Setup Local Environment</h4>
<p>From the root of the repository you can type <code>docker-compose up -d</code>. This will bring up four services, 
2 python connexion services (that mock the aws gateway validation and sirius rest api validation 
respectively) and a postgres database and pact broker image for running pact tests.</p>
<h4>Setup Branch Environment</h4>
<p>Branch environments are set up through the CI pipeline. However if you wish to build one manually 
for whatever reason then you can run the following (replacing <myworkspace> with whatever you want 
your workspace to be called):</p>
<div class="highlight"><pre><span></span><code><span class="err">cd terraform/environment</span>
<span class="err">export TF_WORKSPACE=&lt;myworkspace&gt;</span>
<span class="err">aws-vault exec identity -- terraform init</span>
<span class="err">aws-vault exec identity -- terraform plan</span>
<span class="err">aws-vault exec identity -- terraform apply  </span>
</code></pre></div>


<p>More information on working with workspaces can be found in the technologies used tab.</p>
<h4>ADRs</h4>
<p>Can be found <a href="https://github.com/ministryofjustice/opg-data-deputy-reporting/tree/master/docs/architecture/decisions">here</a> 
and <a href="https://github.com/ministryofjustice/opg-data/tree/master/docs/architecture">here</a>.</p>
<h4>Testing</h4>
<p>Testing is accomplished by using a combination of unit tests and contract testing (using pact).</p>
<p>Unit tests can be run locally by running the following from the root directory of the repo:</p>
<div class="highlight"><pre><span></span><code><span class="err">virtualenv venv</span>
<span class="err">source venv/bin/activate</span>
<span class="err">pip install -r ./lambda_functions/v1/requirements/dev-requirements.txt</span>
<span class="err">python -m pytest</span>
</code></pre></div>


<p>Local Pact testing instructions in progress.</p>
<h4>Design Diagrams</h4>
<p>No end to end diagrams</p></div>
	</div>
		<footer>
		  <p>Powered by <a href="http://getpelican.com/">Pelican</a>. Theme based on <a href="http://twitter.github.com/bootstrap/">Twitter Bootstrap</a>.</p>
		  <p>&copy; Ministry of Justice</p>
		</footer>
	  </div>

	</div>
</body>
</html>